<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Private Router Manager</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
  <header class="header">
    <div class="header-brand">
      <img src="{{ url_for('static', filename='logo.png') }}" alt="" class="header-logo header-logo-dark" aria-hidden="true">
      <img src="{{ url_for('static', filename='logo_dark.png') }}" alt="" class="header-logo header-logo-light" aria-hidden="true">
      <h1>Private Router Manager</h1>
    </div>
    <div class="header-actions">
      <button type="button" class="btn-help" id="helpBtn" aria-label="Help" title="Help">?</button>
      <button type="button" class="theme-toggle" id="themeToggle" aria-label="Toggle light/dark mode" title="Toggle light/dark mode">☀</button>
    </div>
  </header>

  <main class="main">
    <section class="options-bar">
      <div class="options-group">
        <div class="options-row">
          <label class="checkbox-opt">
            <input type="checkbox" id="sameCredentials" checked>
            Same credentials for all routers
          </label>
          <div class="cred-fields" id="credFields">
            <input type="text" id="globalUsername" placeholder="Username">
            <input type="password" id="globalPassword" placeholder="Password">
          </div>
        </div>
        <div class="options-row">
          <label class="checkbox-opt">
            <input type="checkbox" id="samePort" checked>
            Same port for all routers
          </label>
          <div class="port-field" id="portField">
            <input type="number" id="globalPort" value="8080" placeholder="Port" min="1" max="65535">
          </div>
        </div>
      </div>
    </section>

    <section class="csv-section">
      <div class="csv-toolbar">
        <div class="toolbar-actions">
          <button type="button" class="btn btn-secondary" id="btnOpen">Open</button>
          <label class="btn btn-secondary">
            Upload
            <input type="file" id="csvUpload" accept=".csv" hidden>
          </label>
          <button type="button" class="btn btn-secondary" id="btnDownload">Download</button>
          <button type="button" class="btn btn-secondary" id="btnNewCsv">New CSV</button>
          <button type="button" class="btn btn-secondary" id="btnSave">Save</button>
          <button type="button" class="btn btn-secondary" id="btnSaveAs">Save As</button>
          <button type="button" class="btn btn-secondary" id="btnAddRow">Add Row</button>
          <button type="button" class="btn btn-secondary" id="btnAddCol">Add Column</button>
        </div>
        <h2>Routers</h2>
      </div>

      <div class="csv-editor-wrap">
        <div class="csv-table-wrap" id="csvTableWrap">
          <table class="csv-table" id="csvTable">
            <thead id="csvHead"></thead>
            <tbody id="csvBody"></tbody>
          </table>
        </div>
      </div>

      <div class="empty-state" id="emptyState">
        <p>No router data. Upload a CSV file or add rows manually.</p>
        <p class="hint">CSV must include an "ip address" or "ip_address" column.</p>
      </div>
    </section>

    <aside class="drawer" id="drawer">
      <button type="button" class="drawer-toggle" id="drawerToggle" aria-label="Toggle deployment panel">
        <span class="toggle-icon" id="drawerArrow">◀</span>
        <span class="toggle-label">Deployment</span>
      </button>
      <div class="drawer-content" id="drawerContent">
        <h3>Deployment</h3>
        <div class="deploy-type">
          <label for="deployType">Type</label>
          <select id="deployType">
            <option value="online_status">Online Status</option>
            <option value="licenses">Licenses</option>
            <option value="ncos">NCOS</option>
            <option value="configuration">Configuration</option>
            <option value="sdk_apps">SDK Apps</option>
          </select>
        </div>

        <div class="ssh-port-field" id="sshPortField" style="display: none;">
          <label for="sshPort">SSH port (for SDK Apps)</label>
          <input type="number" id="sshPort" value="22" min="1" max="65535" placeholder="22">
        </div>

        <div class="file-upload" id="fileUploadSection">
          <label for="deployFile">Upload file</label>
          <input type="file" id="deployFile" hidden>
          <button type="button" class="btn btn-secondary btn-block" id="btnUploadDeploy">Choose file to upload</button>
        </div>

        <div class="ncos-download" id="ncosDownloadSection" style="display: none;">
          <button type="button" class="ncos-download-toggle" id="ncosDownloadToggle" aria-expanded="false">
            <span class="ncos-toggle-icon">▶</span>
            <span>Download from Cradlepoint ECM</span>
          </button>
          <div class="ncos-download-content" id="ncosDownloadContent">
            <div class="ncos-api-status" id="ncosApiStatus"></div>
            <div class="ncos-api-keys">
              <label>API Keys (required)</label>
              <input type="text" id="ncosCpId" placeholder="X-CP-API-ID">
              <input type="password" id="ncosCpKey" placeholder="X-CP-API-KEY">
              <input type="text" id="ncosEcmId" placeholder="X-ECM-API-ID">
              <input type="password" id="ncosEcmKey" placeholder="X-ECM-API-KEY">
              <button type="button" class="btn btn-secondary btn-block" id="btnSaveNcosKeys">Save API Keys</button>
            </div>
            <div class="ncos-search">
              <input type="text" id="ncosVersion" placeholder="Version (e.g. 7.22.60)">
              <input type="text" id="ncosModel" placeholder="Model (e.g. ibr900)">
<button type="button" class="btn btn-secondary btn-block" id="btnNcosSearch">Search NCOS</button>
          </div>
          <div class="ncos-firmware-list">
            <label>Select NCOS</label>
            <div class="ncos-select-wrap">
              <select id="ncosFirmwareList" size="4"></select>
            </div>
              <button type="button" class="btn btn-secondary btn-block" id="btnNcosDownload">Download Selected</button>
            </div>
          </div>
        </div>

        <div class="available-files" id="availableFilesSection">
          <label>Available files</label>
          <select id="availableFiles" size="5">
            <!-- populated by JS -->
          </select>
        </div>

        <div class="deploy-actions">
          <button type="button" class="btn btn-primary btn-block" id="btnDeploy">Deploy</button>
          <button type="button" class="btn btn-primary btn-block" id="btnOnlineStatus" style="display: none;">Check Online Status</button>
        </div>

        <div class="deploy-status" id="deployStatus"></div>
      </div>
    </aside>
  </main>

  <div class="modal" id="saveAsModal">
    <div class="modal-content">
      <h3>Save As</h3>
      <input type="text" id="saveAsFilename" placeholder="filename.csv">
      <div class="modal-actions">
        <button type="button" class="btn btn-secondary" id="btnSaveAsCancel">Cancel</button>
        <button type="button" class="btn btn-primary" id="btnSaveAsConfirm">Save</button>
      </div>
    </div>
  </div>

  <div class="modal" id="openModal">
    <div class="modal-content">
      <h3>Open</h3>
      <label>Select file from csv folder</label>
      <select id="openFileList" size="8"></select>
      <div class="modal-actions">
        <button type="button" class="btn btn-secondary" id="btnOpenCancel">Cancel</button>
        <button type="button" class="btn btn-primary" id="btnOpenConfirm">Open</button>
      </div>
    </div>
  </div>

  <div class="modal" id="helpModal">
    <div class="modal-content modal-help">
      <div class="modal-help-header">
        <h3>Help</h3>
        <button type="button" class="btn-help-close" id="helpClose" aria-label="Close">×</button>
      </div>
      <div class="modal-help-body" id="helpContent"></div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/marked@4.3.0/lib/marked.umd.js"></script>
  <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>
